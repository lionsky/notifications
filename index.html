<!DOCTYPE html>
<html>
  <head>
    <title>WebViewNotifications</title>
  </head>
  <body>
    <table>
      <tr>
        <td>hartbeat:</td>
        <td width="250px" id="hartbeat"></td>
      </tr>
      <tr>
        <td>title:</td>
        <td><input id="notificationtitle" type="text" value="Hello"></td>
      </tr>
    </table>
      <button type="button" onclick="requestPermission()">req permission</button>
      <button type="button" onclick="register()">register</button>
      <button type="button" onclick="showNotification()">show persistent</button>

<table id="logTable">
</table>
  
    <script type="text/javascript">
      var beat="";
      function hartbeat() {
        beat=beat+".";
        if (beat==="....") beat="";
        document.getElementById("hartbeat").innerHTML = beat;
        setTimeout(hartbeat, 2000);
      }
      
      hartbeat();
      
      /*
      function showNotification(title, body, icon, data) {
        var notificationOptions = {
           body: body,
           icon: icon ? icon : 'images/touch/chrome-touch-icon-192x192.png',
           tag: 'simple-push-demo-notification',
           data: data
        };
        self.registration.showNotification(title, notificationOptions);
        return;
      }
      */

      function requestPermission() {
        Notification.requestPermission(function(status) {
                alert('permission: '+status);
                logToHtml('permission: '+ status);
        });
      }
      
      function logToHtml(message) {
          var table = document.getElementById("logTable");
          var row = table.insertRow(-1);
          var cell = row.insertCell();
          cell.innerHTML = message;
      }
      
      function register() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
          alert('registr success');
        }).catch(function(err) {
          console.log('ServiceWorker registration failed: ', err);
          alert('registr fail:'+err);
        });
      }
      
      function showNotification() {
      
         navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
           alert("ha");
           var title = document.getElementById("notificationtitle").value;
           serviceWorkerRegistration.showNotification(title);
           
           /*
           navigator.serviceWorker.addEventListener('notificationclick', function(event) {
                 var url = event.notification.data.url;
                 console.log('HA -- '+url);
                 alert('click:'+url);
                 serviceWorkerRegistration.showNotification("bla-X");
                //event.waitUntil(clients.openWindow(url));
           });
           */
         });
//      showNotification("bla");
     //ServiceWorkerRegistration.showNotification("bla").then(function(){ alert("hi"); });
      }
    </script>

  </body>
</html>
